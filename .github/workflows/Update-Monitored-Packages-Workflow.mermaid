flowchart

    Start([Update Monitored Packages]) --> LoopStart[Initialize Loop: process each tracked library in Packages.json]

    subgraph Left ["Check for Updates to Monitored Packages"]

        JSON["Sample entry in Packages.json:<br/><br/>{<br/>  name: Microsoft.Identity.Client.Broker,<br/>  version: 4.79.2<br/>}"]
        style JSON text-align: left
        JSON --> CompareVersion

        LoopStart[Initialize Loop: process each tracked library in Packages.json]
        LoopStart --> CheckPackage[Check NuGet.org for the latest package version]
        CheckPackage --> CompareVersion{Is JSON tracking the latest version number?}

        CompareVersion -->|No:<br />Current Entry < Latest Release | UpdateAvailable["Update Available<br/>Add to Summary"]
        CompareVersion -->|Yes:<br />Current Entry = Latest Release | UpToDate[✓ Already Up to Date]

        UpdateAvailable --> MarkUpdate[Set updates_available=true<br/>Append to update_summary]
        UpToDate --> NextPackage{More Packages?}
        MarkUpdate --> NextPackage

        NextPackage -->|Yes| CheckPackage
        NextPackage -->|No| AnyUpdates{Updates Available?}

    end

    subgraph Right ["Download Updates if Available"]

        AnyUpdates -->|No| EndNoUpdate["✓ All packages up to date<br/>Workflow Complete"]
        AnyUpdates -->|Yes| DownloadLoop

        DownloadLoop --> Download[Download .nupkg<br/>from NuGet.org]
        Download --> Extract[Extract nupkg<br/>as ZIP archive]

        Extract --> FindFramework[Search for DLLs in<br/>framework paths]

        FindFramework --> TryPaths{Try Framework Paths}
        TryPaths -->|netstandard2.0| PathFound1
        TryPaths -->|netstandard2.1| PathFound1
        TryPaths -->|net6.0| PathFound1
        TryPaths -->|net472| PathFound1
        TryPaths -->|runtimes/win paths| PathFound1

        PathFound1{DLLs Found?}
        PathFound1 -->|Yes| CopyDLLs[Copy DLLs to<br/>Assembly folder]
        PathFound1 -->|No| WarnNoDLL["⚠️ Warning: No compatible DLLs<br/>Continue to next"]

        CopyDLLs --> UpdateJSON[Update version in<br/>Packages.json]
        UpdateJSON --> MarkUpdated[Mark as updated]

        MarkUpdated --> MoreDownloads{More Packages?}
        WarnNoDLL --> MoreDownloads

        MoreDownloads -->|Yes| DownloadLoop
        MoreDownloads -->|No| SaveJSON[Save updated<br/>Packages.json]

    end

subgraph Finalization ["Finalize and Release"]

    SaveJSON --> ModuleManifest[Read Module Manifest]

    ModuleManifest --> IncrementVersion[Increment Patch Version<br/>x.y.z → x.y.z+1]
    IncrementVersion --> UpdateManifest[Update Module Manifest<br/>with new version]

    UpdateManifest --> GitConfig[Configure Git User:<br/>github-actions bot]

    GitConfig --> GitStage[Stage Changes:<br/>Assembly/*.dll<br/>Assembly/Packages.json<br/>DLLPickle.psd1]

    GitStage --> GitCommit[Commit Changes:<br/>Update MSAL packages:<br/>summary message]
    GitCommit --> GitPush[Push to Repository]

    GitPush --> CreateRelease[Create GitHub Release]
    CreateRelease --> ReleaseDetails[Set Release Details:<br/>Tag: v&lcub;new_version&rcub;<br/>Title: Release v&lcub;new_version&rcub;<br/>Body: Package update summary]

    ReleaseDetails --> PublishRelease[Publish Release:<br/>Not draft, Not prerelease]

    PublishRelease --> ReleaseSuccess["✓ GitHub Release Created"]

    ReleaseSuccess --> EndSuccess([Workflow Complete])
    EndNoUpdate --> EndSuccess
    Error1 --> EndSuccess

end
