<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ReportTitle}}</title>
    <style>
      :root {
        --bg: #f5f7fb;
        --card: #ffffff;
        --text: #17202a;
        --muted: #6b7280;
        --accent: #1f6feb;
        --ok-bg: #e6ffed;
        --ok-border: #27a243;
        --warn-bg: #fff7e6;
        --warn-border: #f59e0b;
        --bad-bg: #fff0f0;
        --bad-border: #dc2626;
        --badge-bg: #efefef;
        --mono: Consolas, monospace;
        --radius: 10px;
        --pad: 12px;
        --shadow: 0 6px 18px rgba(18, 24, 33, 0.06);
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: Inter, Segoe UI, system-ui, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
      }
      .wrap {
        max-width: 1100px;
        margin: 28px auto;
        padding: 12px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
      }
      header h1 {
        margin: 0;
        font-size: 1.35rem;
      }
      header .meta {
        color: var(--muted);
        font-size: 0.95rem;
      }

      .summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      }
      .card {
        background: var(--card);
        border-radius: var(--radius);
        padding: var(--pad);
        box-shadow: var(--shadow);
      }
      .card h2 {
        margin: 0 0 8px 0;
        font-size: 1rem;
      }
      .small {
        color: var(--muted);
        font-size: 0.9rem;
      }

      /* badges */
      .badge {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--badge-bg);
        font-weight: 600;
        font-size: 0.85rem;
      }
      .ver {
        background: linear-gradient(90deg, #f0f7ff, #eaf5ff);
        padding: 4px 8px;
        border-radius: 8px;
        border: 1px solid #dbeafe;
        font-weight: 700;
      }

      /* tables */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
      }
      th,
      td {
        padding: 8px 10px;
        border-bottom: 1px solid #eef2f7;
        text-align: left;
        font-size: 0.95rem;
      }
      th {
        background: transparent;
        color: var(--muted);
        font-weight: 600;
      }
      .mono {
        font-family: var(--mono);
        font-size: 0.9rem;
        color: #2b3940;
      }

      /* conflict rows */
      .conflict-row {
        background: linear-gradient(90deg, #fff5f5, #fff);
        border-left: 4px solid var(--bad-border);
      }
      .redundant-row {
        background: linear-gradient(90deg, #f7fffb, #fff);
        border-left: 4px solid var(--ok-border);
      }

      /* collapsible */
      .collapsible {
        cursor: pointer;
      }
      .toggle-btn {
        background: transparent;
        border: 0;
        font-weight: 700;
        color: var(--accent);
        cursor: pointer;
      }
      .module-details {
        display: none;
        margin-top: 8px;
      }

      /* layout */
      .section {
        margin-bottom: 18px;
      }
      .scope-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
      }

      /* responsive */
      @media (max-width: 880px) {
        .summary {
          grid-template-columns: 1fr;
        }
        table th,
        table td {
          font-size: 0.88rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>{{ReportTitle}}</h1>
          <div class="meta">
            Generated: <strong>{{GeneratedOn}}</strong> &nbsp; • &nbsp; Scope:
            <strong>{{ScopeSearched}}</strong> &nbsp; • &nbsp; DeepInspection:
            <strong>{{DeepInspection}}</strong>
          </div>
        </div>
        <div class="ver">Module DLL Inventory</div>
      </header>

      <section class="summary">
        <div class="card">
          <h2>Summary</h2>
          <div class="small">
            Modules scanned: <strong>{{ModuleCount}}</strong>
          </div>
          <div class="small">
            DLL references found: <strong>{{InventoryCount}}</strong>
          </div>
          <div style="margin-top: 8px">{{SummarySection}}</div>
        </div>

        <div class="card">
          <h2>Top Conflicts</h2>
          <div class="small">
            Conflicts detected: <strong>{{ConflictCount}}</strong>
          </div>
          <div style="margin-top: 8px">{{ConflictSummary}}</div>
        </div>

        <div class="card">
          <h2>Top Redundancies</h2>
          <div class="small">
            Redundancies: <strong>{{RedundancyCount}}</strong>
          </div>
          <div style="margin-top: 8px">{{RedundancySummary}}</div>
        </div>
      </section>

      <section class="section card">
        <h2 class="collapsible" onclick="toggleSection('dlls')">
          DLL Inventory <button class="toggle-btn">Toggle</button>
        </h2>
        <div id="dlls">
          <table>
            <thead>
              <tr>
                <th>DLL</th>
                <th>Version</th>
                <th>Modules (full list)</th>
                <th>Reference</th>
              </tr>
            </thead>
            <tbody>
              {{DllTable}}
            </tbody>
          </table>
        </div>
      </section>

      <section class="section card">
        <h2 class="collapsible" onclick="toggleSection('conflicts')">
          Conflicts <button class="toggle-btn">Toggle</button>
        </h2>
        <div id="conflicts">{{ConflictTable}}</div>
      </section>

      <section class="section card">
        <h2 class="collapsible" onclick="toggleSection('redundancies')">
          Redundancies <button class="toggle-btn">Toggle</button>
        </h2>
        <div id="redundancies">{{RedundancyTable}}</div>
      </section>

      <section class="section card">
        <h2 class="collapsible" onclick="toggleSection('scopes')">
          Scope Breakdown <button class="toggle-btn">Toggle</button>
        </h2>
        <div id="scopes">
          <div class="scope-grid">{{ScopeBreakdown}}</div>
        </div>
      </section>

      <section class="section card">
        <h2 class="collapsible" onclick="toggleSection('modules')">
          Full Module Details <button class="toggle-btn">Toggle</button>
        </h2>
        <div id="modules">{{FullModuleTable}}</div>
      </section>

      <footer class="small" style="margin-top: 18px; color: var(--muted)">
        Report generated by Get-ModuleDllInventory
      </footer>
    </div>

    <script>
      function toggleSection(id) {
        var el = document.getElementById(id);
        if (!el) return;
        el.style.display = el.style.display === "none" ? "block" : "none";
      }
      // initialize sections visible
      ["dlls", "conflicts", "redundancies", "scopes", "modules"].forEach(
        function (id) {
          var el = document.getElementById(id);
          if (el) el.style.display = "block";
        }
      );

      // small helpers for collapsing individual module details (injected per-row)
      function toggleDetails(id) {
        var el = document.getElementById(id);
        if (!el) return;
        el.style.display = el.style.display === "none" ? "block" : "none";
      }
    </script>
  </body>
</html>
